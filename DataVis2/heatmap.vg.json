{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Number of Movies by Year Category and Genre (Filtered)",
  "width": 480,
  "height": 300,
  "data": {"url": "imdb_top_1000.csv"},
  "transform": [
    {
      "calculate": "datum.Released_Year < 1980 ? 'Before 1980' : datum.Released_Year < 1990 ? '1980s' : datum.Released_Year < 2000 ? '1990s' : datum.Released_Year < 2010 ? '2000s' : '2010s'",
      "as": "Decade"
    },
    {
      "calculate": "split(datum.Genre, ', ')",
      "as": "GenreList"
    },
    {"flatten": ["GenreList"]},
    {
      "filter": "datum.GenreList != 'Film-Noir' && datum.GenreList != 'Musical' && datum.GenreList != 'Western' && datum.GenreList != 'Sport' && datum.Released_Year < 2020"
    },
    {
      "aggregate": [{"op": "count", "as": "Movie_Count"}],
      "groupby": ["Decade", "GenreList"]
    },
    {
      "joinaggregate": [{"op": "sum", "field": "Movie_Count", "as": "Total_Count"}],
      "groupby": ["GenreList"]
    }
  ],
  "encoding": {
    "x": {
      "field": "Decade",
      "type": "ordinal",
      "axis": {
        "title": "Decade",
        "labelAngle": 0  
      },
      "sort": ["Before 1980", "1980s", "1990s", "2000s", "2010s"]
    },
    "y": {
      "field": "GenreList",
      "type": "ordinal",
      "sort": "-x",
      "axis": {"title": "Genre"}
    },
    "color": {
      "field": "Movie_Count",
      "type": "quantitative",
      "scale": {
        "domain": [10, 20, 50, 120, 180],
        "range": ["#deebf7", "#9ecae1", "#3182bd", "#08519c", "#08306b"]
      },
      "legend": {
        "title": "Number of Movies",
        "orient": "bottom"  
      }
    },
    "tooltip": [
      {"field": "Decade", "type": "ordinal"},
      {"field": "GenreList", "type": "ordinal"},
      {"field": "Movie_Count", "type": "quantitative"}
    ]
  },
  "mark": "rect"
}
