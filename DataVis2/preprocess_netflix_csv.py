import pandas as pd

df = pd.read_csv("netflix_titles.csv")
df = df.dropna(subset=["country"])
df = df.assign(country=df["country"].str.split(", ")).explode("country")

country_mapping = {
    "United States": "United States of America",
    "Russia": "Russian Federation",
    "South Korea": "Korea, Republic of",
    "North Korea": "Korea, Democratic People's Republic of",
    "Iran": "Iran, Islamic Republic of",
    "Egypt": "Egypt, Arab Republic of",
    "Vietnam": "Viet Nam",
    "Syria": "Syrian Arab Republic",
    "Bolivia": "Bolivia, Plurinational State of",
    "Venezuela": "Venezuela, Bolivarian Republic of",
    "Laos": "Lao People's Democratic Republic",
    "Tanzania": "Tanzania, United Republic of",
    "Czech Republic": "Czechia"
}

df["country"] = df["country"].replace(country_mapping)

country_counts = df["country"].value_counts().reset_index()
country_counts.columns = ["country", "count"]

population_2021 = {
    "United States of America": 331002651,
    "India": 1393409038,
    "United Kingdom": 68207116,
    "Canada": 38005238,
    "France": 67391582,
    "Japan": 125836021,
    "Spain": 47351567,
    "Korea, Republic of": 51709098,
    "Germany": 83240525,
    "Mexico": 126014024,
    "China": 1411778724,
    "Australia": 25788216,
    "Egypt, Arab Republic of": 109262178,
    "Turkey": 85652000,
    "Hong Kong": 7474200,
    "Nigeria": 213401323,
    "Italy": 59554023,
    "Brazil": 213993437,
    "Argentina": 45605823,
    "Belgium": 11589623,
    "Indonesia": 273753191,
    "Taiwan": 23568378,
    "Philippines": 111046913,
    "Thailand": 69950850,
    "South Africa": 59308690,
    "Colombia": 51516562,
    "Netherlands": 17441139,
    "Denmark": 5831404,
    "Ireland": 4994724,
    "Sweden": 10160101,
    "Singapore": 5637000,
    "Poland": 37750000,
    "United Arab Emirates": 9770529,
    "New Zealand": 5084300,
    "Lebanon": 5540720,
    "Norway": 5421241,
    "Israel": 9216900,
    "Chile": 19116209,
    "Russian Federation": 143446060,
    "Malaysia": 32776000,
    "Pakistan": 231402117,
    "Czechia": 10708981,
    "Switzerland": 8715490,
    "Romania": 19286123,
    "Uruguay": 3426260,
    "Saudi Arabia": 35840452,
    "Austria": 8917205,
    "Luxembourg": 634814,
    "Iceland": 343599,
    "Greece": 10718565,
    "Finland": 5536146,
    "Hungary": 9607780,
    "Qatar": 2930520,
    "Peru": 33050325,
    "Bulgaria": 6896662,
    "Jordan": 10203140,
    "Kuwait": 4270563,
    "Serbia": 6643300,
    "Viet Nam": 98168829,
    "Kenya": 47564296,
    "Portugal": 10305564,
    "Morocco": 36910558,
    "West Germany": 78288576,
    "Ghana": 31072945,
    "Cambodia": 16718971,
    "Croatia": 4105267,
    "Iran, Islamic Republic of": 85028760,
    "Venezuela, Bolivarian Republic of": 28301498,
    "Bangladesh": 166303498,
    "Malta": 514564,
    "Senegal": 16743930,
    "Algeria": 44700000,
    "Soviet Union": 286700000,
    "Slovenia": 2107000,
    "Zimbabwe": 15000000,
    "Syrian Arab Republic": 22125247,
    "Ukraine": 41732779,
    "Iraq": 40222503,
    "Guatemala": 18092026,
    "Georgia": 3714000,
    "Nepal": 29136808,
    "Mauritius": 1265740,
    "Namibia": 2587801,
    "Cayman Islands": 65720,
    "Lithuania": 2794700,
    "Cuba": 11326616,
    "Nicaragua": 6729403,
    "Uganda": 45711874,
    "Dominican Republic": 10847904,
    "Latvia": 1867000,
    "East Germany": 16900000,
    "Azerbaijan": 10139177,
    "Samoa": 222382,
    "Afghanistan": 39835428,
    "Panama": 4314767,
    "Botswana": 2429154,
    "Vatican City": 825,
    "Sudan": 44909350,
    "Jamaica": 2961161,
    "Somalia": 16359515,
    "Kazakhstan": 19091949,
    "Liechtenstein": 38128,
    "Palestine": 5263000,
    "Sri Lanka": 21919000,
    "Cyprus": 1207359,
    "Burkina Faso": 21929937,
    "Ethiopia": 120283026,
    "Cameroon": 27744989,
    "Angola": 33933611,
    "Mozambique": 32969518,
    "Belarus": 9336490,
    "Puerto Rico": 3285874,
    "Malawi": 19129952,
    "Bahamas": 393244,
    "Paraguay": 7132530,
    "Albania": 2837743,
    "Slovakia": 5456362,
    "Bermuda": 63903,
    "Ecuador": 17930484,
    "Armenia": 2963234,
    "Mongolia": 3322177,
    "Montenegro": 620739
}

pop_df = pd.DataFrame(list(population_2021.items()), columns=["country", "population_2021"])
country_counts = pd.merge(country_counts, pop_df, on="country", how="left")
country_counts["titles_per_million"] = (country_counts["count"] / country_counts["population_2021"]) * 10000000
country_counts.to_csv("netflix_country_counts.csv", index=False)
